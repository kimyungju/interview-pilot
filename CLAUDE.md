# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Build & Development Commands

```bash
npm run dev          # Start dev server on port 3000
npm run build        # Production build
npm run start        # Run production build
npm run lint         # ESLint check
npx drizzle-kit push # Push schema changes to Supabase PostgreSQL
```

## Environment Variables

Required in `.env.local` (not committed):

- `NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY` / `CLERK_SECRET_KEY` — Clerk auth
- `NEXT_PUBLIC_CLERK_SIGN_IN_URL` / `NEXT_PUBLIC_CLERK_SIGN_UP_URL` — Clerk routes
- `NEXT_PUBLIC_GEMINI_API_KEY` — Google Gemini AI
- `SUPABASE_DB_URL` — PostgreSQL connection string for Drizzle ORM

## Architecture

**Next.js 16 App Router** with server actions (no API routes). All data mutations and AI calls happen in `app/actions/` files marked `"use server"`. Pages using React hooks or browser APIs are marked `"use client"`.

### Data Flow

```
User Form → Server Action → Gemini API → Drizzle ORM → Supabase PostgreSQL
```

**Interview lifecycle:** Create (Gemini generates 5 Q&A) → Execute (speech recognition captures answers) → Feedback (Gemini rates each answer)

### Key Layers

- **`lib/`** — Shared infrastructure: `db.ts` (Drizzle + Neon serverless driver), `schema.ts` (MockInterview/UserAnswer tables), `gemini.ts` (Gemini client + JSON response cleaner), `utils.ts` (Shadcn `cn()` helper)
- **`app/actions/`** — Server actions: `interview.ts` (create/list/get interviews), `answer.ts` (submit answers with AI feedback, get answers)
- **`app/dashboard/`** — Protected routes (Clerk middleware in `middleware.ts` guards `/dashboard/**`)
- **`components/ui/`** — Shadcn UI components (button, dialog, input, textarea, collapsible). Auto-generated, do not manually modify.
- **`types/speech.d.ts`** — TypeScript declarations for Web Speech API (`SpeechRecognition`, `webkitSpeechRecognition`)

### Route Structure

| Route | Component Type | Purpose |
|-------|---------------|---------|
| `/` | Server | Landing page |
| `/dashboard` | Client | Interview list + create dialog |
| `/dashboard/interview/[interviewId]` | Client | Interview setup, webcam toggle |
| `/dashboard/interview/[interviewId]/start` | Client | Live interview: speech recording, question navigation, webcam |
| `/dashboard/interview/[interviewId]/feedback` | Client | Collapsible results with ratings |

### Database Schema (Drizzle ORM)

Two tables in `lib/schema.ts`:
- **MockInterview** — stores job details + Gemini's 5 Q&A pairs as JSON string (`jsonMockResp`), linked by `mockId` (UUID)
- **UserAnswer** — stores per-question user answer, AI feedback, and rating, linked by `mockIdRef`

## Conventions

- **Import alias:** `@/` maps to project root (e.g., `@/lib/db`, `@/components/ui/button`)
- **Shadcn UI:** New York style, neutral base color, CSS variables. Add components via `npx shadcn@latest add <component>`
- **Icons:** Lucide React (`lucide-react`)
- **Styling:** Tailwind CSS v4 with responsive grids. Theme tokens defined as CSS variables in `app/globals.css`
- **Dashboard components:** Scoped under `app/dashboard/_components/` (Next.js convention to exclude from routing)
- **Gemini responses:** Always strip markdown code fences via `cleanJsonResponse()` before `JSON.parse()`

## Commit Message Rules

- **No AI attribution:** Never include "Co-authored by Claude Code," "Generated by AI," or any equivalent metadata in commit messages.
- **Conciseness:** Keep commit messages brief, focusing only on the essential changes.
- **Cleanliness:** Ensure the message appears as if written manually by a human developer.